<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Highlight Standalone Demo</title>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #222;
            color: #ddd;
        }

        h1,
        h2,
        h3 {
            margin-bottom: 20px;
        }

        p {
            margin-bottom: 15px;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Controls */
        .controls {
            margin-bottom: 20px;
        }

        .dark-mode-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        /* Content */
        .content {
            padding: 20px;
            border: 1px solid #eaeaea;
            border-radius: 5px;
            background-color: #fff;
            margin-bottom: 20px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        body.dark-mode .content {
            background-color: #333;
            border-color: #444;
        }

        /* Selection menu */
        .selection-menu {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 8px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 150px;
            animation: fadeIn 0.2s ease-in-out;
            transition: background-color 0.3s;
        }

        body.dark-mode .selection-menu {
            background-color: rgba(51, 51, 51, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .selection-actions {
            display: flex;
            gap: 8px;
        }

        .action-button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-button:hover {
            background-color: #f0f0f0;
            border-color: #ccc;
        }

        .action-button.selected {
            background-color: #e6f7ff;
            border-color: #1890ff;
            color: #1890ff;
        }

        body.dark-mode .action-button {
            border-color: #444;
            color: #ddd;
        }

        body.dark-mode .action-button:hover {
            background-color: #444;
            border-color: #555;
        }

        body.dark-mode .action-button.selected {
            background-color: #096dd9;
            border-color: #1890ff;
            color: #fff;
        }

        .selection-controls {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .confirm-button,
        .cancel-button {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .confirm-button {
            background-color: #52c41a;
            color: white;
            border: none;
        }

        .confirm-button:hover {
            background-color: #73d13d;
        }

        .cancel-button {
            background-color: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }

        .cancel-button:hover {
            background-color: #fafafa;
            color: #333;
        }

        body.dark-mode .cancel-button {
            background-color: #444;
            color: #ddd;
            border-color: #555;
        }

        body.dark-mode .cancel-button:hover {
            background-color: #555;
            color: #fff;
        }

        /* Color picker */
        .highlight-color-picker {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .highlight-color-options {
            display: flex;
            gap: 8px;
        }

        .highlight-color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .highlight-color-option:hover {
            transform: scale(1.1);
        }

        .highlight-color-option.selected {
            border: 2px solid #333;
            transform: scale(1.1);
        }

        body.dark-mode .highlight-color-option.selected {
            border-color: #fff;
        }

        .highlight-color-yellow {
            background-color: rgba(255, 255, 0, 0.5);
        }

        .highlight-color-green {
            background-color: rgba(0, 255, 0, 0.5);
        }

        .highlight-color-blue {
            background-color: rgba(0, 191, 255, 0.5);
        }

        .highlight-color-pink {
            background-color: rgba(255, 105, 180, 0.5);
        }

        .highlight-color-purple {
            background-color: rgba(147, 112, 219, 0.5);
        }

        /* Instructions */
        .instructions {
            padding: 20px;
            border: 1px solid #eaeaea;
            border-radius: 5px;
            background-color: #f9f9f9;
            transition: background-color 0.3s, border-color 0.3s;
        }

        body.dark-mode .instructions {
            background-color: #2a2a2a;
            border-color: #444;
        }

        .instructions ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .instructions p {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        body.dark-mode .instructions p {
            color: #aaa;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Highlight Standalone Demo</h1>
        <p>This is a standalone demo of the highlighting feature for the Urantia Book reader. Select text in the content
            below to see the selection menu with highlighting options.</p>

        <div class="controls">
            <label class="dark-mode-toggle">
                <input id="darkModeToggle" type="checkbox">
                Dark Mode
            </label>
        </div>

        <div class="content" id="contentContainer">
            <h2>The Universal Father</h2>
            <p>
                Of all the names by which God the Father is known throughout the universes, those which designate him as
                the First Source and the Universe Center are most often encountered. The First Father is known by
                various names in different universes and in different sectors of the same universe. The names which the
                creature assigns to the Creator are much dependent on the creature's concept of the Creator.
            </p>
            <p>
                The Universal Father never imposes any form of arbitrary recognition, formal worship, or slavish service
                upon the intelligent will creatures of the universes. The evolutionary inhabitants of the worlds of time
                and space must of themselves ‚Äî in their own hearts ‚Äî recognize, love, and voluntarily worship him.
            </p>
            <p>
                When you have once become truly God-conscious, after you really discover the majestic Creator and begin
                to experience the realization of the indwelling presence of the divine controller, then, in accordance
                with your enlightenment and in accordance with the manner and method by which the divine Sons reveal
                God, you will find a name for the Universal Father which will be adequately expressive of your concept
                of the First Great Source and Center.
            </p>
        </div>

        <div class="instructions">
            <h3>Instructions</h3>
            <ol>
                <li>Select text in the content area above</li>
                <li>Click the highlight icon (üñåÔ∏è) in the menu</li>
                <li>Choose a color from the color picker</li>
                <li>Click the checkmark to apply the highlight</li>
            </ol>
            <p>
                In dark mode, highlighting changes the text color. In light mode, it adds a background highlight.
            </p>
        </div>
    </div>

    <script>
        // DOM elements
        const contentContainer = document.getElementById('contentContainer');
        const darkModeToggle = document.getElementById('darkModeToggle');

        // State
        let selectionMenu = null;
        let selectedText = '';
        let selectedAction = null;
        let selectedColor = 'yellow';
        let showingColorPicker = false;

        // Dark mode
        let isDarkMode = false;

        // Toggle dark mode
        darkModeToggle.addEventListener('change', () => {
            isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
        });

        // Create selection menu
        function createSelectionMenu(position) {
            // Remove existing menu if any
            removeSelectionMenu();

            // Create menu element
            selectionMenu = document.createElement('div');
            selectionMenu.className = 'selection-menu';
            selectionMenu.style.top = `${position.top}px`;
            selectionMenu.style.left = `${position.left}px`;

            if (showingColorPicker) {
                createColorPicker();
            } else {
                createActionButtons();
            }

            // Add menu to document
            document.body.appendChild(selectionMenu);
        }

        // Create action buttons
        function createActionButtons() {
            // Create actions container
            const actionsContainer = document.createElement('div');
            actionsContainer.className = 'selection-actions';

            // Create action buttons
            const highlightButton = document.createElement('button');
            highlightButton.className = `action-button ${selectedAction === 'highlight' ? 'selected' : ''}`;
            highlightButton.innerHTML = 'üñåÔ∏è';
            highlightButton.title = 'Highlight text';
            highlightButton.addEventListener('click', () => {
                selectedAction = 'highlight';
                showingColorPicker = true;
                createSelectionMenu({
                    top: parseInt(selectionMenu.style.top),
                    left: parseInt(selectionMenu.style.left)
                });
            });

            const copyButton = document.createElement('button');
            copyButton.className = `action-button ${selectedAction === 'copy' ? 'selected' : ''}`;
            copyButton.innerHTML = 'üìã';
            copyButton.title = 'Copy text';
            copyButton.addEventListener('click', () => {
                selectedAction = 'copy';
                updateActionButtons();
            });

            const noteButton = document.createElement('button');
            noteButton.className = `action-button ${selectedAction === 'note' ? 'selected' : ''}`;
            noteButton.innerHTML = 'üìù';
            noteButton.title = 'Add note';
            noteButton.addEventListener('click', () => {
                selectedAction = 'note';
                updateActionButtons();
            });

            const quoteButton = document.createElement('button');
            quoteButton.className = `action-button ${selectedAction === 'quote' ? 'selected' : ''}`;
            quoteButton.innerHTML = 'üí¨';
            quoteButton.title = 'Save quote';
            quoteButton.addEventListener('click', () => {
                selectedAction = 'quote';
                updateActionButtons();
            });

            // Add buttons to actions container
            actionsContainer.appendChild(highlightButton);
            actionsContainer.appendChild(copyButton);
            actionsContainer.appendChild(noteButton);
            actionsContainer.appendChild(quoteButton);

            // Create controls container
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'selection-controls';

            // Create confirm button
            const confirmButton = document.createElement('button');
            confirmButton.className = 'confirm-button';
            confirmButton.textContent = '‚úì';
            confirmButton.title = 'Apply';
            confirmButton.addEventListener('click', handleConfirm);

            // Create cancel button
            const cancelButton = document.createElement('button');
            cancelButton.className = 'cancel-button';
            cancelButton.textContent = '‚úï';
            cancelButton.title = 'Cancel';
            cancelButton.addEventListener('click', removeSelectionMenu);

            // Add buttons to controls container
            controlsContainer.appendChild(confirmButton);
            controlsContainer.appendChild(cancelButton);

            // Add containers to menu
            selectionMenu.appendChild(actionsContainer);
            selectionMenu.appendChild(controlsContainer);

            // Function to update action buttons
            function updateActionButtons() {
                // Reset all buttons
                highlightButton.className = 'action-button';
                copyButton.className = 'action-button';
                noteButton.className = 'action-button';
                quoteButton.className = 'action-button';

                // Highlight selected button
                if (selectedAction === 'highlight') {
                    highlightButton.className = 'action-button selected';
                } else if (selectedAction === 'copy') {
                    copyButton.className = 'action-button selected';
                } else if (selectedAction === 'note') {
                    noteButton.className = 'action-button selected';
                } else if (selectedAction === 'quote') {
                    quoteButton.className = 'action-button selected';
                }
            }
        }

        // Create color picker
        function createColorPicker() {
            // Create color picker container
            const colorPickerContainer = document.createElement('div');
            colorPickerContainer.className = 'highlight-color-picker';

            // Create color options container
            const colorOptionsContainer = document.createElement('div');
            colorOptionsContainer.className = 'highlight-color-options';

            // Create color options
            const colors = ['yellow', 'green', 'blue', 'pink', 'purple'];
            colors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = `highlight-color-option highlight-color-${color} ${selectedColor === color ? 'selected' : ''}`;
                colorOption.title = `${color} highlight`;
                colorOption.addEventListener('click', () => {
                    selectedColor = color;
                    updateColorOptions();
                });
                colorOptionsContainer.appendChild(colorOption);
            });

            // Create controls container
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'selection-controls';

            // Create confirm button
            const confirmButton = document.createElement('button');
            confirmButton.className = 'confirm-button';
            confirmButton.textContent = '‚úì';
            confirmButton.title = 'Apply highlight';
            confirmButton.addEventListener('click', handleHighlightConfirm);

            // Create cancel button
            const cancelButton = document.createElement('button');
            cancelButton.className = 'cancel-button';
            cancelButton.textContent = '‚úï';
            cancelButton.title = 'Cancel';
            cancelButton.addEventListener('click', () => {
                showingColorPicker = false;
                createSelectionMenu({
                    top: parseInt(selectionMenu.style.top),
                    left: parseInt(selectionMenu.style.left)
                });
            });

            // Add buttons to controls container
            controlsContainer.appendChild(confirmButton);
            controlsContainer.appendChild(cancelButton);

            // Add containers to color picker
            colorPickerContainer.appendChild(colorOptionsContainer);
            colorPickerContainer.appendChild(controlsContainer);

            // Add color picker to menu
            selectionMenu.appendChild(colorPickerContainer);

            // Function to update color options
            function updateColorOptions() {
                const colorOptions = colorOptionsContainer.querySelectorAll('.highlight-color-option');
                colorOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.classList.contains(`highlight-color-${selectedColor}`)) {
                        option.classList.add('selected');
                    }
                });
            }
        }

        // Remove selection menu
        function removeSelectionMenu() {
            if (selectionMenu) {
                document.body.removeChild(selectionMenu);
                selectionMenu = null;
                selectedAction = null;
                showingColorPicker = false;
            }
        }

        // Handle confirm button click
        function handleConfirm() {
            if (selectedAction === 'copy') {
                // Copy selected text
                navigator.clipboard.writeText(selectedText).then(() => {
                    alert(`Copied: "${selectedText.substring(0, 30)}${selectedText.length > 30 ? '...' : ''}"`);
                }).catch(err => {
                    console.error('Failed to copy text:', err);
                });
            } else if (selectedAction === 'note') {
                // Add note (in a real app, this would add a note)
                alert(`Note added for: "${selectedText}"`);
            } else if (selectedAction === 'quote') {
                // Add quote (in a real app, this would save a quote)
                alert(`Quote saved: "${selectedText}"`);
            } else if (selectedAction === 'highlight') {
                // Show color picker
                showingColorPicker = true;
                createSelectionMenu({
                    top: parseInt(selectionMenu.style.top),
                    left: parseInt(selectionMenu.style.left)
                });
                return;
            }

            // Remove selection menu
            removeSelectionMenu();
        }

        // Handle highlight confirm
        function handleHighlightConfirm() {
            // Get the selected range
            const selection = window.getSelection();
            if (!selection || selection.isCollapsed) return;

            const range = selection.getRangeAt(0);

            // Create a span element for the highlight
            const highlightSpan = document.createElement('span');

            // Set the highlight color based on dark mode
            if (isDarkMode) {
                // In dark mode, change the text color
                highlightSpan.style.color = getColorValue(selectedColor);
            } else {
                // In light mode, use background highlight
                highlightSpan.style.backgroundColor = `rgba(${getColorRGB(selectedColor)}, 0.5)`;
            }

            // Surround the selected text with the highlight span
            range.surroundContents(highlightSpan);

            // Collapse the selection
            selection.removeAllRanges();

            // Remove selection menu
            removeSelectionMenu();
        }

        // Helper function to get color value
        function getColorValue(color) {
            switch (color) {
                case 'yellow':
                    return '#ffff00';
                case 'green':
                    return '#00ff00';
                case 'blue':
                    return '#00bfff';
                case 'pink':
                    return '#ff69b4';
                case 'purple':
                    return '#9370db';
                default:
                    return '#ffff00';
            }
        }

        // Helper function to get RGB values for colors
        function getColorRGB(color) {
            switch (color) {
                case 'yellow':
                    return '255, 255, 0';
                case 'green':
                    return '0, 255, 0';
                case 'blue':
                    return '0, 191, 255';
                case 'pink':
                    return '255, 105, 180';
                case 'purple':
                    return '147, 112, 219';
                default:
                    return '255, 255, 0';
            }
        }

        // Handle mouse up event
        contentContainer.addEventListener('mouseup', (event) => {
            // Ignore right-click
            if (event.button === 2) return;

            // Get selection
            const selection = window.getSelection();
            if (!selection || selection.isCollapsed) {
                removeSelectionMenu();
                return;
            }

            // Get selected text
            selectedText = selection.toString().trim();
            if (selectedText.length < 3) {
                removeSelectionMenu();
                return;
            }

            // Calculate menu position
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();

            const position = {
                top: rect.bottom + window.scrollY + 10,
                left: rect.left + window.scrollX,
            };

            // Create selection menu
            createSelectionMenu(position);
        });

        // Handle context menu event (right-click)
        contentContainer.addEventListener('contextmenu', (event) => {
            // Get selection
            const selection = window.getSelection();
            if (!selection || selection.isCollapsed) return;

            // Get selected text
            selectedText = selection.toString().trim();
            if (selectedText.length < 3) return;

            // Prevent default context menu
            event.preventDefault();

            // Calculate menu position
            const position = {
                top: event.clientY + window.scrollY,
                left: event.clientX + window.scrollX,
            };

            // Create selection menu
            createSelectionMenu(position);
        });

        // Handle click outside
        document.addEventListener('mousedown', (event) => {
            if (selectionMenu && !selectionMenu.contains(event.target) && !contentContainer.contains(event.target)) {
                removeSelectionMenu();
            }
        });
    </script>
</body>

</html>