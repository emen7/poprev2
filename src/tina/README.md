# TinaCMS Integration

This directory contains the TinaCMS integration for the PopRev2 platform. TinaCMS is a headless content management system that provides a visual editing experience for content stored in Git.

## Overview

The TinaCMS integration consists of:

1. **Configuration**: The `config.ts` file defines the TinaCMS configuration, including the content schemas for different document types.
2. **Client**: The `client.ts` file provides a client for interacting with TinaCMS, including methods for fetching documents and document lists.
3. **Generated Files**: The `__generated__` directory contains files generated by TinaCMS based on the configuration.

## Content Schemas

The following content schemas are defined:

### Base Document Schema

All document types inherit from a base schema that includes:

- Title
- Author
- Publication Date
- Categories
- Tags

### Scientific Document Schema

Extends the base schema with:

- Abstract
- Citations (list of citation objects)
- Figures (list of figure objects)

### Perplexity Document Schema

Extends the base schema with:

- Original Question
- Responses (list of response objects with text and sources)

### Lectionary Document Schema

Extends the base schema with:

- Scripture References (list of scripture reference objects)
- Liturgical Season

## Usage

### Accessing TinaCMS Admin

The TinaCMS admin interface is available at `/admin`. This interface allows you to:

1. Create new documents
2. Edit existing documents
3. Delete documents
4. Manage media assets

### Using TinaCMS in Components

To use TinaCMS in your components:

1. Import the TinaCMS provider:

```tsx
import { TinaCMSProvider } from "../components/tina-provider";
```

2. Wrap your component with the provider:

```tsx
<TinaCMSProvider>{/* Your component content */}</TinaCMSProvider>
```

3. Use the TinaCMS client to fetch content:

```tsx
import { fetchDocument, fetchDocumentList } from "../tina/client";

// Fetch a single document
const document = await fetchDocument("document-name.md", "scientific");

// Fetch a list of documents
const documents = await fetchDocumentList("scientific");
```

### Displaying TinaCMS Content

To display content from TinaCMS:

1. Use the `TinaDocumentLoader` component:

```tsx
import { TinaDocumentLoader } from "../components/tina-document-loader";

<TinaDocumentLoader
  relativePath="document-name.md"
  documentType="scientific"
/>;
```

This component:

- Fetches the document from TinaCMS
- Transforms it using the document transformation system
- Displays it using the DocumentReader component

## Environment Variables

The TinaCMS integration requires the following environment variables:

- `NEXT_PUBLIC_TINA_CLIENT_ID`: The client ID for TinaCMS (get this from tina.io)
- `TINA_TOKEN`: The token for TinaCMS (get this from tina.io)
- `NEXT_PUBLIC_TINA_GRAPHQL_URL`: The GraphQL URL for TinaCMS (optional, defaults to a standard URL)

## Local Development

For local development, you can use TinaCMS in local mode, which doesn't require a TinaCMS account. To do this:

1. Start the TinaCMS server:

```bash
npx tinacms dev -c "npm run dev"
```

This will start both the TinaCMS server and the Next.js development server.

2. Access the TinaCMS admin interface at `/admin`

3. Make changes to content, which will be saved to the local file system

## Production Deployment

For production deployment:

1. Create a TinaCMS account at [tina.io](https://tina.io)
2. Set up a project and get your client ID and token
3. Set the environment variables in your deployment platform (e.g., Vercel)
4. Deploy your application

## Customization

To customize the TinaCMS integration:

1. **Add New Collections**: Edit the `config.ts` file to add new collections with their own schemas
2. **Modify Existing Schemas**: Edit the existing schemas in `config.ts` to add or remove fields
3. **Customize the Admin UI**: TinaCMS allows for customization of the admin UI through the `ui` property in the collection configuration

## Troubleshooting

Common issues and solutions:

- **Generated Files Not Updated**: Run `npx tinacms dev` to regenerate the files
- **Authentication Issues**: Check that your environment variables are set correctly
- **Content Not Showing**: Ensure that the content path in the TinaCMS configuration matches the actual file path
